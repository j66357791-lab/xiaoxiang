# 1. åŸºç¡€é•œåƒ
FROM node:18-alpine

# 2. ä¿®å¤æ—¶åŒº
RUN apk add --no-cache tzdata && \
    cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
    echo "Asia/Shanghai" > /etc/timezone && \
    apk del tzdata

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV TZ=Asia/Shanghai
ENV NODE_ENV=production

# 3. è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# 4. å¤åˆ¶æ–‡ä»¶
COPY . .

# 5. è‡ªåŠ¨ä¿®å¤ job.service.js é‡Œçš„å¼•ç”¨è·¯å¾„
RUN sed -i "s|import Order from './order.model.js'|import Order from '../orders/order.model.js'|g" src/modules/jobs/job.service.js

# 6. å®‰è£…ä¾èµ–
RUN npm install

# 7. ğŸ‘‡ ä¿®æ­£ï¼šæš´éœ²ç«¯å£æ”¹ä¸º 3000ï¼Œä¸ server.js é»˜è®¤å€¼ä¸€è‡´
EXPOSE 3000

# 8. å¯åŠ¨å‘½ä»¤
CMD ["npm", "start"]
