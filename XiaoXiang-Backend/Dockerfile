# 1. åŸºç¡€é•œåƒ
FROM node:18-alpine

# 2. ä¿®å¤æ—¶åŒº
RUN apk add --no-cache tzdata && \
    cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
    echo "Asia/Shanghai" > /etc/timezone && \
    apk del tzdata

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV TZ=Asia/Shanghai
ENV NODE_ENV=production
# ğŸ‘‡ ç»Ÿä¸€æ”¹ä¸º 8080
ENV PORT=8080

# 3. è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# 4. åªå¤åˆ¶ XiaoXiang-Backend ç›®å½•ä¸‹çš„å†…å®¹åˆ° /app
COPY XiaoXiang-Backend/ .

# 5. ä¿®å¤ä»£ç é‡Œçš„å¼•ç”¨è·¯å¾„
RUN sed -i "s|import Order from './order.model.js'|import Order from '../orders/order.model.js'|g" src/modules/jobs/job.service.js

# 6. å®‰è£…ä¾èµ–
RUN npm install

# 7. æš´éœ² 8080 ç«¯å£
EXPOSE 8080

# 8. å¯åŠ¨å‘½ä»¤
CMD ["npm", "start"]
